# 2025-07-27 — Auth Test Suite for rizz.market

## Project
- QA automation for https://rizz.market / https://app.rizz.market
- Stack: Python pytest + Playwright
- Files: `/workspace/tests/conftest.py`, `/workspace/tests/test_auth.py`, `/workspace/pytest.ini`, `/workspace/requirements.txt`

## Auth Flow
- Direct nav to `app.rizz.market/auth/sign-in`
- Click "Другие способы входа" to reveal phone/password form
- Phone field has "+7" placeholder with mask auto-formatting
- Valid creds: phone `+79087814701`, password `89087814701`
- After login → `/app/advertiser/campaigns` with heading "Кампании"
- Cookie consent dialog appears after login

## Key Locator Issues
- `exact=True` required for "Войти" button (3 matches without it)
- `exact=True` required for error text "Пользователь не найден" (2 matches)
- `aria-invalid` stays "false" on empty submit — need alternative validation selector for auth-06–09

## Test Status (16 tests: auth-01 through auth-16)
- 13 passed, 3 failing (auth-04, auth-05, auth-06)
- auth-04/05: fix with `exact=True` on error text locator
- auth-06: need to find correct validation indicator in DOM

## Users
- DanilQA (tg:7706432018) — operator
- Kim Bubnov (tg:5129504709) — owner

## Architecture (POM + PCO + PFA) — completed
- **Pages**: BasePage, SignInPage, CampaignsPage (`tests/pages/`)
- **Components**: BaseComponent, LoginFormComponent, NotificationComponent (`tests/components/`)
- **Elements (PageFactory)**: BaseElement, Button, Input, Textarea, FileInput, Link, Text, Icon, Image (`tests/elements/`)
- **Flows**: AuthFlow (`tests/flows/auth_flow.py`)
- **Tests**: 5 classes in `tests/auth/test_auth.py` with `@pytest.mark.regression` + `@pytest.mark.authorization`
- Git repo: `https://github.com/Danil63/rizz-qa-tests.git` (main branch)
- Commits: `0efeffc` (main refactor), `63146aa` (section comments)

## Allure Integration — in progress
- ✅ allure.step added to: all PageFactory elements, all components, all pages
- ❌ Pending: AuthFlow allure.step, test_auth.py decorators (@allure.feature/story/title), conftest screenshot-on-failure
- `allure-pytest` in requirements.txt, `--alluredir=allure-results` in pytest.ini

## Naming Convention
- Methods: `{action}_{context}_{element}` (e.g. `click_login_button`)
- Section comments: `# Компоненты`, `# Локаторы элементов`, `# ── Методы действий ──`, `# ── Методы проверок ──`
- BaseElement `type_of` property for Allure step names

---

## Update (session 2)

### Allure — COMPLETE
- All 16 test files have full decorators: `@allure.epic`, `@allure.feature`, `@allure.story`, `@allure.title`, `@allure.severity`, `@allure.description`, `@allure.tag`
- AuthFlow methods wrapped with `allure.step`
- Screenshot-on-failure hook in `tests/conftest.py` with `page.is_closed()` guard
- `environment.properties` auto-generated in `pytest_sessionfinish`
- Fixtures use `@allure.title()` decorator (official pattern)

### Test Suite — expanded to 16 files
- `test_auth_01` through `test_auth_16` in `tests/auth/`
- Renumbered from prior 6-test scheme
- Severity: CRITICAL for auth-01/02, NORMAL for rest

### Architecture updates
- **Blogger fixture**: `tests/fixtures/blogger_fixture.py` — logs in as Данил СЗ (+79938854791), verifies MarketPage
- **MarketPage**: `tests/pages/market_page.py` for `/app/creator/market`
- **LandingPage**: `tests/pages/landing_page.py` — exists but unused (site too heavy)
- Blogger creds: phone `+79938854791`, password `89087814701`, User ID `06b7069e-f66f-4013-beb1-3d2861b7923f`

### Toast/Sonner discovery
- Toast library: **Sonner** — toasts in `ol[data-sonner-toaster]` as `<li data-state="open">`
- Text example: "Произошла ошибка Пользователь не найден"
- Auto-dismisses fast — needs MutationObserver or pre-set wait

### Browser config
- `headless=False`, `no_viewport=True`, `--start-maximized`
- Latest commit: `8219ce7`

### Still fixing
- test_auth_04 (unregistered user toast locator)
- test_auth_09 (invalid phone validation message)
- NotificationComponent needs Sonner `<li>` locator update

---

## Update (session 3) — Market, Filters, Products, CreateProduct

### Project Restructure
- Tests moved to `tests/test_suites/{auth,filters,market}/`
- Components: `tests/components/market_components/` (CampaignCardComponent, FilterComponent)

### New Pages
- **ProductsPage** (`tests/pages/products_page.py`): `/app/advertiser/products` — product list as `<li>`, dt/dd metadata, filter Товар/Услуга, buttons Создать/Синхронизация/Архив, status badge "На ведении", pagination "Загрузить ещё"
- **CreateProductPage** (`tests/pages/create_product_page.py`): `/app/advertiser/products/create` — image upload, tabs Товар/Услуга, fields (Артикул, Название, Описание, Категория 27 opts, Бренд, Маркетплейс 14 opts, Цена, Ссылка), `fill_all_fields()` method

### New Components
- **CampaignCardComponent**: `.rounded-xl.bg-white.p-1` + badge locators (АВТООДОБРЕНИЕ=`span.bg-purple`, НАЛОГ ОПЛАЧЕН/С МАРКИРОВКОЙ=`div.bg-lime`)
- **FilterComponent**: search + 6 dropdowns (Соц.сеть, Маркетплейс, Категория, Вознаграждение, Опции, Сортировка), `select_dropdown_option()`, `check_badge_visible_in_cards()`

### New Tests
- **9 filter tests** (`tests/test_suites/filters/`): search, clear, dropdowns combo, marketplace, social, category, reward, options, badge visibility
- **11 market tests** (`tests/test_suites/market/test_market_01_page_elements.py`): page elements + 3 badge tests
- Storage state auth for filters: session fixture logs in once → `.auth_state.json`

### Validation Errors (CreateProduct empty submit)
- Locator: `p.text-sm.text-red-700`; labels turn `rgb(185, 28, 28)` on error
- Errors: Image="Обязательное поле", Артикул="Значение слишком маленькое. Минимум: 5", Название/Описание/Категория/Бренд/Маркетплейс/Цена="Обязательное поле", Ссылка="Неверный формат ссылки"

### Test Data
- Product image: `tests/test_data/product_image.jpg` (FEDAST nails)

### Git
- Latest commit: `a7a390b` — CreateProductPage POM + test product image

### In Progress
- Updating create_product_page.py with validation error locators & assertion methods
- Writing product creation tests
- Fixing test_auth_04 (Sonner toast) and test_auth_09 (invalid phone validation)
